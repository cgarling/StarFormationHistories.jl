<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>OLD Mass-Metallicity Relations (MZRs) · StarFormationHistories.jl</title><meta name="title" content="OLD Mass-Metallicity Relations (MZRs) · StarFormationHistories.jl"/><meta property="og:title" content="OLD Mass-Metallicity Relations (MZRs) · StarFormationHistories.jl"/><meta property="twitter:title" content="OLD Mass-Metallicity Relations (MZRs) · StarFormationHistories.jl"/><meta name="description" content="Documentation for StarFormationHistories.jl."/><meta property="og:description" content="Documentation for StarFormationHistories.jl."/><meta property="twitter:description" content="Documentation for StarFormationHistories.jl."/><script data-outdated-warner src="../../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../search_index.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">StarFormationHistories.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Overview</a></li><li><span class="tocitem">Deriving Star Formation Histories from Hess Diagrams</span><ul><li><a class="tocitem" href="../../../fitting_intro/">Background and Template Construction</a></li><li><a class="tocitem" href="../../../unconstrained/">High-Level Methods for Unconstrained Fitting</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Constrained Metallicity Evolution</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-2-3-2" type="checkbox"/><label class="tocitem" for="menuitem-2-3-2"><span class="docs-label">AMRs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../linear_amr/">Linear Age-Metallicity Relation</a></li><li><a class="tocitem" href="../../log_amr/">Logarithmic Age-Metallicity Relation</a></li><li><a class="tocitem" href="../../fixed_amr/">Fixed Age-Metallicity Relations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3-3"><span class="docs-label">MZRs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../MZR/">Mass-Metallicity Relations (MZRs)</a></li></ul></li><li><a class="tocitem" href="../../dispersion_models/">Metallicity Dispersion Models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../internals/">Low-Level Functions</a></li><li><a class="tocitem" href="../../../kernels/">Kernels</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../../examples/">Examples</a></li><li><a class="tocitem" href="../../../../simulate/">Simulating Color-Magnitude Diagrams</a></li><li><a class="tocitem" href="../../../../binaries/">Binary Systems</a></li><li><a class="tocitem" href="../../../../helpers/">Helper Functions</a></li><li><a class="tocitem" href="../../../../doc_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>OLD Mass-Metallicity Relations (MZRs)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>OLD Mass-Metallicity Relations (MZRs)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/cgarling/StarFormationHistories.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/cgarling/StarFormationHistories.jl/blob/main/docs/src/fitting/hierarchical/MZR/MZR_old.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MZR_old"><a class="docs-heading-anchor" href="#MZR_old">OLD Mass-Metallicity Relations (MZRs)</a><a id="MZR_old-1"></a><a class="docs-heading-anchor-permalink" href="#MZR_old" title="Permalink"></a></h1><p>The parametric age-metallicity relations (AMRs) provided by this package are typically sufficient to provide good fits to observed CMDs with very few degrees of freedom. However, they are somewhat arbitrary and unphysical as they have no direct relation to the underlying star formation activity, which is what enrichs the ISM in the first place. As such, physical interpretation of AMRs is dubious – rather, it is often the population-integrated metallicity distribution functions (MDFs) which are compared against external datasets that directly probe stellar metallicities (e.g., single-star spectroscopy).</p><p>As we are simultaneously fitting both the historical star formation rates (SFRs) and the metallicity at which those stars are forming over time, it is possible to design a framework in which the metallicity evolves in a self-consistent way with the star formation activity. As the AMR describes the mean metallicity of stars forming at different times, it should be most directly related to the metallicity evolution of the star-forming ISM. We therefore need to connect the star formation activity to the ISM metallicity.</p><p>This is complicated by the fact that in general one-zone chemical models, both star-formation driven outflows (which deplete the ISM of both metals and HI) and pristine gas inflows (composed majorly of HI which dilutes the metallicity of the ISM) must be modelled. While hydrodynamic simulations can provide predictions of outflow rates (i.e., through mass-loading factors), the inflow rates are time-variable, depend on the local environment, and generally unconstrained observationally on an object-to-object basis. As such, general one-zone chemical models are unattractive for our purposes.</p><p>A more attractive formulation can be found in the idea of an effective yield, which is the fraction of stellar mass that is composed of metals <span>$\gamma = M_{Z,*} / M_*$</span>. As shown by <a href="https://ui.adsabs.harvard.edu/abs/2019MNRAS.484.5587T">Torrey et al. 2019</a>, who measured these yields in the Illustris TNG100 simulation, these yields are primarily a function of total galaxy stellar mass and not of redshift. Therefore, the rate of change of the yield with respect to stellar mass <span>$\frac{\partial \gamma}{\partial M_*}$</span> can be connected to the rate at which metals are accumulated in stars as galaxies grow.</p><p>Further, the existence of the gas-phase mass-metallicity relation (MZR) for star-forming galaxies gives us some empirical guidance for an implementation, as the AMR should be mostly connected to the gas-phase metallicity. While the MZR is mostly unconstrained for the low-mass galaxies that are typically studied in the Local Universe with resolved photometry (<span>$M_* &lt; 10^8 \; \text{M}_\odot$</span>), the MZR is often extrapolated to low masses as a power law in stellar mass.</p><p>While it is known that higher-mass galaxies do not strictly evolve <em>along</em> the MZR, due in large part to the time variability of inflows mentioned above, the simple form of the power law extrapolation of the MZR allows for a simple experiment. If (on average) the ISM metallicity at time <span>$t$</span> is primarily driven by the total stellar mass at that time <span>$M_*(t)$</span>, then a two-parameter MZR (power law slope and intercept) coupled to the SFRs in the SFH fitting process should result in better CMD models than a similar two-parameter AMR (e.g., the <a href="../../linear_amr/#linear_amr_section">linear AMR model</a>) which has no mathematical link to the SFRs. In turn, the best-fit SFRs and population-integrated MDFs should also be more accurate if the modelled AMR is better.</p><h2 id="Derivation"><a class="docs-heading-anchor" href="#Derivation">Derivation</a><a id="Derivation-1"></a><a class="docs-heading-anchor-permalink" href="#Derivation" title="Permalink"></a></h2><p>We once again wish to derive the gradient of the objective function with respect to the fitting parameters to enable gradient-based optimization. Our derivation will reuse some of the notation developed in the section on the <a href="../../linear_amr/#linear_amr_section">linear AMR</a>. The main difference is that instead of expressing the mean metallicity as a function of time <span>$\langle [\text{M}/\text{H}] \rangle (t)$</span>, with an MZR we express the mean metallicity as a function of stellar mass at that time <span>$\langle [\text{M}/\text{H}] \rangle (\text{M}_*(t))$</span>. This means that the partial derivatives of the objective with respect to the stellar mass coefficients have a more complex form than in the AMR case, as changing the stellar mass formed 10 Gyr ago (for example) would change the total stellar mass at all more recent times, which in turn changes the mean metallicity expected at all more recent times.</p><p>In the derivations for AMRs we were agnostic about the choice of template normalization; templates could either be normalized to have units of expected number of stars per solar mass of stars formed <span>$[N / \text{M}_\odot]$</span>, or expected number of stars per unit star formation rate <span>$[N / \dot{\text{M}}_\odot]$</span>. Changing the units of the templates would, in turn, change the units of the fitting variables returned by the fitting routines, but as shown in our example Jupyter notebook, the fit results are the same no matter the choice of fitting units. For an MZR, we <em>must</em> know the units of the templates and fitting variables so that we may properly calculate the total cumulative stellar mass as a function of time. <em>For simplicity, we assume templates are normalized to number of stars per solar mass of stars formed <span>$[N / \text{M}_\odot]$</span> and that the fitting variables are therefore the total stellar mass ascribed to each time bin – this is the default behavior for the template creation routines.</em></p><p>Borrowing notation from <a href="../../../fitting_intro/#fitting">the fitting introduction</a> and the <a href="../../linear_amr/#linear_amr_section">section on linear AMRs</a>, the bin <span>$m_i$</span> of the complex model Hess diagram can be written as the sum over the grid of templates with ages indexed by <span>$j$</span> and metallicities indexed by <span>$k$</span> as</p><p class="math-container">\[m_i = \sum_{j,k} \, r_{j,k} \; c_{i,j,k}\]</p><p>where <span>$m_i$</span> is the value of the complex model in bin <span>$i$</span>, <span>$c_{i,j,k}$</span> is the value of the SSP template with age <span>$j$</span> and metallicity <span>$k$</span> in bin <span>$i$</span>, and <span>$r_{j,k}$</span> is the multiplicative coefficient determining how significant the template is to the complex population.</p><p>The gradient of the objective with respect to the <span>$r_{j,k}$</span> is given by Equation 21 in Dolphin 2001 as shown in the <a href="../../linear_amr/#linear_amr_section">section on linear AMRs</a>,</p><p class="math-container">\[\begin{aligned}
F \equiv - \text{ln} \, \mathscr{L} &amp;= \sum_i m_i - n_i \times \left( 1 - \text{ln} \, \left( \frac{n_i}{m_i} \right) \right) \\
\frac{\partial \, F}{\partial \, r_{j,k}} &amp;= \sum_i c_{i,j,k} \left( 1 - \frac{n_i}{m_i} \right)
\end{aligned}\]</p><p>where <span>$n_i$</span> is bin <span>$i$</span> of the observed Hess diagram. These partial derivatives are easy to obtain, but we need partials with respect to the total stellar mass formed at each distinct age, <span>$R_j$</span>. These are more complicated that the same partial derivatives under an AMR model.</p><p>For the purposes of illustration, we will consider a power law MZR with slope <span>$\alpha$</span> as is typically used to describe the extrapolation of gas-phase MZRs to masses below <span>$10^8 \text{M}_\odot$</span>. Under this model, we can express the mean metallicity at time <span>$j$</span>, notated as <span>$\mu_j$</span>, as</p><p class="math-container">\[\begin{aligned}
\mu_j &amp;= [\text{M}/\text{H}]_0 + \text{log} \left( \left( \frac{\text{M}_* (t_j)}{\text{M}_0} \right)^\alpha \right) \\
&amp;= [\text{M}/\text{H}]_0 + \alpha \, \left( \text{log} \left( \text{M}_* (t_j) \right) - \text{log} \left( \text{M}_0 \right) \right) \\
\end{aligned}\]</p><p>where the power law MZR is normalized such that the mean metallicity is <span>$[\text{M}/\text{H}]_0$</span> at stellar mass <span>$\text{M}_0$</span>. Note that the MZR comes linear with slope <span>$\alpha$</span> when expressed in <span>$\text{log}(\text{M}_*)$</span>. As in the AMR models, we use a Gaussian to introduce some metallicity dispersion at fixed time, such that the <span>$r_{j,k}$</span> are</p><p class="math-container">\[\begin{aligned}
r_{j,k} &amp;= R_j \, \frac{ \text{exp} \left( - \frac{1}{2} \left( \frac{ [\text{M}/\text{H}]_k - \mu_j}{\sigma} \right)^2 \right)}{\sum_k \text{exp} \left( - \frac{1}{2} \left( \frac{ [\text{M}/\text{H}]_k - \mu_j}{\sigma} \right)^2 \right)} \\
A_{j,k} &amp;= \text{exp} \left( - \frac{1}{2} \left( \frac{ [\text{M}/\text{H}]_k - \mu_j}{\sigma} \right)^2 \right) \\
r_{j,k} &amp;= R_j \, \frac{A_{j,k}}{\sum_k A_{j,k}} \\
\end{aligned}\]</p><p>where the <span>$R_j$</span> are the fitting variables representing the total stellar mass formed at each distinct age in the template grid. We define <span>$A_{j,k}$</span> to substitute in for the broadening PDF, as the Gaussian could easily be substituted for other forms with minimal changes to the derivation. The three parameters in the MZR model are therefore the power law slope <span>$\alpha$</span>, a normalization/intercept parameter <span>$[\text{M}/\text{H}]_0$</span>, and the metallicity broadening parameter <span>$\sigma$</span>; this is the same number of parameters as in the linear AMR model.</p><p>We can write the partial derivative of the objective <span>$F$</span> with respect to the <span>$R_j$</span> as</p><p class="math-container">\[\frac{\partial \, F}{\partial \, R_j} = \sum_k \, \frac{\partial \, F}{\partial \, r_{j,k}} \, \frac{\partial \, r_{j,k}}{\partial \, R_j}\]</p><p>For AMRs, this calculation is simple as the mean metallity at time <span>$j$</span>, denoted <span>$\mu_j$</span>, is not a function of <span>$R_j$</span>, and so <span>$\frac{\partial \, r_{j,k}}{\partial \, R_j}$</span> simplifies easily. For MZRs, <span>$\mu_j$</span> is a function of the total stellar mass formed by time <span>$t_j$</span>, which itself is a function of other <span>$R_j$</span> which give the total stellar mass formed in their respective time bins. We must therefore apply the chain rule to formulate the total partial derivative <span>$\frac{\partial \, F}{\partial \, R_j}$</span>.</p><p>Applying the product rule first,</p><p class="math-container">\[\begin{aligned}
r_{j,k} &amp;= R_j \, \frac{A_{j,k}}{\sum_k A_{j,k}} \\
\frac{\partial \, r_{j,k}}{\partial \, R_j} &amp;= \frac{A_{j,k}}{\sum_k A_{j,k}} + R_j \, \left( \frac{\frac{\partial \, A_{j,k}}{\partial \, R_j}}{\sum_k A_{j,k}} - \frac{A_{j,k} \, \frac{\partial \, \sum_k A_{j,k}}{\partial \, R_j}}{\left(\sum_k A_{j,k}\right)^2} \right) \\
\end{aligned}\]</p><p>In AMR models, the term in parentheses on the right hand side is zero as the partial derivatives of all <span>$A_{j,k}$</span> with respect to the stellar mass coefficients <span>$R_j$</span> are zero. These terms are new for the MZR model, as <span>$A_{j,k}$</span> depends on <span>$\mu_j$</span> which depends on the <span>$R_j$</span> through the total stellar mass formed by time <span>$t_j$</span>. </p><p>The first term can be replaced by an equivalent expression which is often more convenient: <span>$\frac{A_{j,k}}{\sum_k A_{j,k}} = \frac{r_{j,k}}{R_j}$</span>. The term <span>$\frac{\partial \, \sum_k A_{j,k}}{\partial \, R_j}$</span> can be replaced by noting that the partial derivative with respect to <span>$R_j$</span> of the sum over <span>$k$</span> of the <span>$A_{j,k}$</span> must be equal to the sum over <span>$k$</span> of the partial derivatives of the individual <span>$A_{j,k}$</span> with respect to <span>$R_j$</span> such that the following equivalency holds true: <span>$\frac{\partial \, \sum_k A_{j,k}}{\partial \, R_j} = \sum_k \frac{\partial \, A_{j,k}}{\partial R_j}$</span>. We therefore have</p><p class="math-container">\[\begin{aligned}
\frac{\partial \, r_{j,k}}{\partial \, R_j} &amp;= \frac{A_{j,k}}{\sum_k A_{j,k}} + R_j \, \left( \frac{\frac{\partial \, A_{j,k}}{\partial \, R_j}}{\sum_k A_{j,k}} - \frac{A_{j,k} \, \frac{\partial \, \sum_k A_{j,k}}{\partial \, R_j}}{\left(\sum_k A_{j,k}\right)^2} \right) \\
&amp;= \frac{r_{j,k}}{R_j} + R_j \, \left( \frac{\frac{\partial \, A_{j,k}}{\partial \, R_j}}{\sum_k A_{j,k}} - \frac{A_{j,k} \, \sum_k \frac{\partial \, A_{j,k}}{\partial \, R_j}}{\left(\sum_k A_{j,k}\right)^2} \right) \\
&amp;= \frac{r_{j,k}}{R_j} + \frac{R_j}{\sum_k A_{j,k}} \left( \frac{\partial \, A_{j,k}}{\partial \, R_j} - \frac{A_{j,k} \, \sum_k \frac{\partial \, A_{j,k}}{\partial \, R_j}}{\sum_k A_{j,k}} \right) \\
\end{aligned}\]</p><p>We now need to formulate the partial derivatives of the dispersion weights with respect to the stellar mass coefficients, <span>$\frac{\partial \, A_{j,k}}{\partial \, R_j}$</span>. The dependence of the <span>$A_{j,k}$</span> on the <span>$R_j$</span> is manifested through the dependence of the <span>$A_{j,k}$</span> on <span>$\mu_j$</span>, which itself is dependent on the <span>$R_j$</span>. We will assume the <span>$\mu_j$</span> for all general MZR models can be expressed as a function of the stellar mass at time <span>$t_j$</span>, which we denote <span>$\text{M}_* \left( t_j \right)$</span>, and that the stellar mass depends on the <span>$R_j$</span>. Applying the chain rule,</p><p class="math-container">\[\begin{aligned}
\frac{\partial \, A_{j,k}}{\partial \, R_j} &amp;= \frac{\partial \, A_{j,k}}{\partial \, \mu_j} \frac{\partial \, \mu_j}{\partial \, R_j} \\
\frac{\partial \, \mu_j}{\partial \, R_j} &amp;= \frac{\partial \, \mu_j}{\partial \, \text{M}_* \left( t_j \right)} \, \frac{\partial \, \text{M}_* \left( t_j \right)}{\partial R_j} \\
\end{aligned}\]</p><p>In the case that the <span>$R_j$</span> represent the amount of stellar mass formed in time bin <span>$t_j$</span>, then the second term reduces to 1. Let the <span>$R_j$</span> be sorted in order from earliest time <span>$t_j$</span> (i.e., largest lookback time) to most recent time (i.e., lowest lookback time). The cumulative stellar mass <span>$\text{M}_* \left( t_j \right)$</span> can therefore be expressed as the sum over the <span>$R_{j^\prime}$</span> for <span>$j^\prime \leq j$</span>, such that</p><p class="math-container">\[\begin{aligned}
\text{M}_* \left( t_j \right) &amp;= \sum_{j^\prime=0}^{j^\prime=j} R_{j^\prime} \\
\frac{\partial \, \text{M}_* \left( t_j \right)}{\partial R_j} &amp;= 1 \\
\end{aligned}\]</p><p>We can therefore make the simplification</p><p class="math-container">\[\begin{aligned}
\frac{\partial \, \mu_j}{\partial \, R_j} &amp;= \frac{\partial \, \mu_j}{\partial \, \text{M}_* \left( t_j \right)} \, \frac{\partial \, \text{M}_* \left( t_j \right)}{\partial R_j} \\
&amp;= \frac{\partial \, \mu_j}{\partial \, \text{M}_* \left( t_j \right)}
\end{aligned}\]</p><p>so that the partial derivatives of the <span>$A_{j,k}$</span> with respect to the <span>$R_j$</span> become</p><p class="math-container">\[\begin{aligned}
\frac{\partial \, A_{j,k}}{\partial \, R_j} &amp;= \frac{\partial \, A_{j,k}}{\partial \, \mu_j} \frac{\partial \, \mu_j}{\partial \, R_j} \\
&amp;= \frac{\partial \, A_{j,k}}{\partial \, \mu_j} \frac{\partial \, \mu_j}{\partial \, \text{M}_* \left( t_j \right)} \\
\end{aligned}\]</p><p>The forms of these partials will depend on the choices of the metallicity dispersion profile at fixed time, which sets the first term involving <span>$A_{j,k}$</span>, as well as the form of the MZR model which will set the partial derivative of the mean metallicity at time <span>$j$</span>, <span>$\mu_j$</span>, with respect to the cumulative stellar mass at time <span>$t_j$</span>. For our choice of a Gaussian metallicity dispersion profile at fixed time we have</p><p class="math-container">\[\begin{aligned}
A_{j,k} &amp;= \text{exp} \left( - \frac{1}{2} \left( \frac{ [\text{M}/\text{H}]_k - \mu_j}{\sigma} \right)^2 \right) \\
\frac{\partial \, A_{j,k}}{\partial \, \mu_j} &amp;= \frac{A_{j,k}}{\sigma^2} \left( [\text{M}/\text{H}]_k - \mu_j \right) \\
\end{aligned}\]</p><p>and for our choice of a power law MZR we have</p><p class="math-container">\[\begin{aligned}
\mu_j &amp;= [\text{M}/\text{H}]_0 + \alpha \, \left( \text{log} \left( \text{M}_* (t_j) \right) - \text{log} \left( \text{M}_0 \right) \right) \\
\frac{\partial \, \mu_j}{\partial \, \text{M}_* \left( t_j \right)} &amp;= \frac{\alpha}{\text{M}_* \left( t_j \right) \, \text{ln} \, 10} \\
\end{aligned}\]</p><p>such that we now have all the terms we need to compute the <span>$\frac{\partial \, r_{j,k}}{\partial \, R_j}$</span> which enables us to compute the partial derivatives of the objective with respect to the <span>$R_j$</span>, <span>$\frac{\partial \, F}{\partial \, R_j} = \sum_k \, \frac{\partial \, F}{\partial \, r_{j,k}} \, \frac{\partial \, r_{j,k}}{\partial \, R_j}$</span>.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Friday 16 May 2025 16:26">Friday 16 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
